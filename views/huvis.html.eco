<!DOCTYPE html>
<html>
  <head>
    <title>Huvis Graph Visualization</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">
    <link rel="icon" href="/favicon.ico?v=4" type="image/x-icon" />
    <link href="/css/huvis.css" rel="stylesheet" type="text/css">
    <link href="/css/huvis_controls.css" rel="stylesheet" type="text/css">
    <link href="/css/lariat.css" rel="stylesheet" type="text/css">
    <link href="/css/CRRT.css" rel="stylesheet" type="text/css">
    <link href="/css/gclui.css" rel="stylesheet" type="text/css">
    <link href="/css/help.css" rel="stylesheet" type="text/css">
    <link href="/jquery-ui-css/jquery-ui.css" rel="stylesheet"/>
    <style>
      #predicates {
        overflow-y: scroll;
        max-height: 20em;
      }
    </style>
  <% if @is_local: %>
    <!--
    <XXlink href="/css/debugging.css" rel="stylesheet"/>
      -->
  <% end %>
    <script>
      window.module = {};
    </script>
    <script src="/node_modules/async/lib/async.js"></script>
    <script src="/vendor/green_turtle.js"></script>
    <script src="/marked/marked.min.js"></script>
  <% if @is_local: %>
    <script src="/vendor/jquery.js"></script>
    <script src="/vendor/d3.v3.min.js"></script>
    <script src="/vendor/jquery-ui.min.js"></script>
  <% else: %>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="//d3js.org/d3.v3.js" charset="utf-8"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.1/jquery-ui.min.js"></script>
  <% end %>
  </head>
  <body>
    <div id="snippet_box"></div>
  <section role="controls" id="tabs">
    <ul style="font-size:80%">
       <li><a href="#tabs-help" title="Introduction and Usage">Intro</a></li>
       <li><a href="#tabs-options" title="Fine tune sizes, lengths and thicknesses.">Settings</a></li>
       <li><a href="#huvis_controls" title="Power tools for controlling the graph with commands consisting of verbs and nouns.">Commands</a></li>
       <li><a href="#tabs-script" title="The sequence of commands which have been performed.">Script</a></li>
       <li><a href="#tabs-hide" title="Shrink this menu for maximum room to play.">‾‾‾</a></li>
    </ul>
    <div id="tabs-help" class="scrolling_tab">
      <h1 class="git-branch-is-<%= @git_branch_name %>">
        HuViz
        <% if @git_commit_hash: %>
          <sup class="git_commit_hash">
            <a target="huviz_version" href="https://github.com/smurp/huviz/commit/<%= @git_commit_hash %>"><%= @git_commit_hash %></a>
          </sup>
        <% end %>
      </h1>
      <h2>Orlando RDF Explorer</h2>
      <h6>(currently works best in Google Chrome)</h6>
      <div class="huviz-versions">
        <a href="http://huviz.dev.nooron.com"
           class="git-branch-is-master <% if @git_branch_name is 'master':%>current-git-branch<% end %>">production</a>
        <a href="http://beta.huviz.dev.nooron.com"
           class="git-branch-is-beta  <% if @git_branch_name is 'beta':%>current-git-branch<% end %>">beta</a>
        <a href="http://alpha.huviz.dev.nooron.com"
           class="git-branch-is-alpha  <% if @git_branch_name is 'alpha':%>current-git-branch<% end %>">alpha</a>
        <a href="/tests">tests</a>
        <a href="/orlonto.html">ontology</a>
      </div>
      <p>This interface is intended to help you explore the
        information and relationships encoded in
        the <a href="http://www.artsrn.ualberta.ca/orlando/" target="_blank">Orlando</a>
        text database of British Women Writers.
        In particular, HuViz helps explore semantic information expressed in
        <a hef="http://www.artsrn.ualberta.ca/orlando/">RDF triples</a>
        that assert things like
        <span class='eg-subject'>Writer</span> <span class='eg-verb'>hasSex</span> <span class='eg-object'>FEMALE</span>
        or <span class='eg-subject'>Writer</span> <span class='eg-verb'>livedInPlace</span> <span class='eg-object'>London</span>.
        HuViz is also able to display the <a href="/orlonto.html">Orlando Ontology</a>,
        the formal definition of the things and relationships depicted here.
      </p>
      <div id="external_docs"></div>
      <style>
      </style>
      <h3>Quick Start</h3>
      <ul>
        <li>Go to <a class="open_tab" href="#2">Commands</a> and pick a <i>data set</i>, for example
	  <em>Maria Abdy</em>.
	</li>
        <li>Drag nodes to and from the central graph, the green shelf and the red discard pile.</li>	
        <li>
	  Engage
	  the <span class="control_label">Verb</span>
	  <i class="human_term__choose">choose</i>
	  and then engage
	  the <span class="control_label">Class</span>
	  <i class="human_term__all">Region</i>
	  and see how several of the nodes are added to the graph because you've just run the command:
	    [<code>
	      <span class="human_term__choose" style="font-weight:normal">Choose</span>
	      <span class="taxon">Region</span>.
	    </code>].
	</li>
        <li>
	  Click the <span class="control_label">Verb</span>
	    <i class="human_term__choose">choose</i> and
          click the <span class="control_label">Class</span>
	    <i class="human_term__all">Region</i>
	  and see how some of the nodes are added to the graph because you've just run the command:
	    [<code style="all:unset;">
	      <span class="human_term__choose">Choose</span>
	      <span class="taxon">Region</span>.
	    </code>].
	</li>
        <li>Go to <a class="open_tab" href="#1">Settings</a> to adjust, especially, the
	  <em>gravity</em>, the <em>charge</em> and the <em>link distance</em>
	  to control how tightly the nodes fit in the graph.
	</li>
        <li>Hover over nodes and edges to see their labels.  Notice that your cursor looks like a little
	  speech bubble telling you what it will do if you click at that moment.
	  It will update while you are dragging things too -- over the shelf or discard bin or
	  while pinning and unpinning.
	</li>
        <li>Click edges to see the snippets of text which inspired them.
	  The cursor's speech bubble will read
	  <code class="speech_bubble">show edge sources</code>
	  when your click will be on an edge.
	</li>
        <li><span class="human_term__chosen">Chosen</span> nodes are marked with a black perimeter.
	  They are the nodes that you've expressed a specific interest in by dragging and dropping them
	  into the graph or by running the verb <span class="human_term__choose">choose</span> on them.
	  When a node is <span class="human_term__chosen" style="text-transform:lowercase">chosen</span>
	  it pulls all the nodes it is connected to into the graph.  It doesn't make them
          <span class="human_term__chosen">Chosen</span> too, but they are
	  <span class="human_term__graphed">Graphed</span> and held in the graph by their connections
	  to <span class="human_term__chosen" style="text-transform:lowercase">chosen</span> nodes.
	  Once a node which is <span class="human_term__graphed">graphed</span> but not
	  <span class="human_term__chosen">Chosen</span> looses its last visible connection
	  to an <span class="human_term__chosen">Chosen</span> node then it automatically leaves the graph.
	</li>
        <li>The verb <span class="human_term__choose">Choose</span>
	  causes all the nodes linked to the
	  <span class="human_term__chosen" style="text-transform:lowercase">chosen</span>
	  node to be pulled into the graph (except any nodes which have been
	  <span class="human_term__discarded">discarded</span>)
	</li>
        <li>The verb <span class="human_term__unchoose">unchoose</span> causes the shelving of all the
	  unchosen nodes which have an edge shown to the chosen node.
	</li>
	<li>Don't worry about
	  <span class="human_term__discard" style="text-transform:lowercase">discard</span>ing
	  nodes, they don't go away for ever.  They are just in the round red discard bin
	  in the bottom right.  You can <span class="human_term__retrieve">retrieve</span>
	  them manually by dragging and dropping them on the
	  graph or the shelf OR you can use the verb
	  <span class="human_term__undiscard">retrieve</span>
	  on them to bring them out in bunches, for example just the people or the
	  <span class="human_term__labelled" style="text-transform:lowercase">labelled</span>
	  ones.
	</li>
      </ul>
    </div>
    <div id="tabs-script" class="scrolling_tab">
      <p>This is the sequence of commands which were performed to produce the current state of the display.
	<i><b>Coming soon.</b></i>
      </p>
    </div>
    <div id="tabs-options" class="graph_controls">
    </div>
    <div id="huvis_controls">
      <div class="unselectable">
        <label title="which file to load">
          <select
              name="data_set" class="file_picker"
              onchange="HVZ.load_file(this)"
              title="data sets are alphabetical">
	    <option value=""> -- Pick a Data Set -- </option>
	    <optgroup label="Individuals">
              <option title="all attributes -- TBD"
		      value="/data/byroau.nq">Augusta Ada Byron</option>
              <option title="all attributes -- 444 nodes; 2325 edges; 41 predicates"
		      value="/data/atwoma.nq">Margaret Atwood</option>
              <option title="all attributes -- 68 nodes; 308 edges; 37 predicates"
		      value="/data/abdyma.nq">Maria Abdy</option>
              <option title="all attributes -- 14 nodes; 60 edges; 17 predicates"		      
		      value="/data/ballrm.nq">R.M. Ballantyne</option>
              <option title="basic relational predicates -- 41 nodes; 46 edges; 21 predicates"
		      value="/data/shakwi.nq">William Shakespeare</option>
	    </optgroup>
 	    <optgroup label="Organizations">
              <option title="all attributes -- ?? nodes; 6200 edges; ?? predicates"
		      disabled=true
		      value="/data/academie_des_femmes.nq">Académie des Femmes</option>
              <option title="all attributes -- ?? nodes; ?? edges; ?? predicates"
		      disabled=true
		      value="/data/african_national_congress.nq">African National Congres</option>
              <option title="all attributes -- 423 node; 666 edges; 43 predicates"
		      value="/data/brontes.nq">The Bronte Sisters</option>
              <option title="all attributes -- 573 nodes; edges 835; predicates 52"
		      value="/data/early_writers.nq">Early Writers</option>
	      <option title="all attributes -- ?? nodes; ?? edges; ?? predicates"
		      value="/data/female_antislavery_society.nq">Female Anti-Slavery Society</option>
              <option title="all attributes -- ?? nodes; 5300 edges; ?? predicates ✓"
		      disabled=true
		      value="/data/newnham_college.nq">Newnham College</option>
	      <option title="all attributes -- 116 nodes; ?? edges; ?? predicates ✓"
		      value="/data/nuns.nq">  Nuns: Middle Ages</option>
	      <option title="all attributes -- ?? nodes; ?? edges; ?? predicates"
		      disabled=true
		      value="/data/the_17th_century_quakers.nq">  The 17th Century Quakers</option>
	      <option title="all attributes -- 516 nodes; ?? edges; ?? predicates ✓"
		      disabled=true
		      value="/data/the_1917_club.nq">  The 1917 Club</option>
	    </optgroup>
 	    <optgroup label="Periodicals">
              <option title="all attributes -- ?? nodes; ?? edges; ?? predicates"
		      value="/data/englishwomans_review.nq">Englishwoman's Review</option>
              <option title="all attributes -- ?? nodes; ?? edges; ?? predicates"
		      disabled=true
		      value="/data/taits_endinburgh_magazine.nq">Tait's Edinburgh Magazine</option>
              <option title="all attributes -- ?? nodes; ?? edges; ?? predicates"
		      disabled=true
		      value="/data/yellow_book_and_poet.nq">The Yellow Book AND Poet</option>
	    </optgroup>
 	    <optgroup label="Publishing Houses">
              <option title="all attributes -- ?? nodes; ?? edges; ?? predicates"
		      disabled=true
		      value="/data/dial_press.nq">Dial Press (modernist)</option>
              <option title="all attributes -- ?? nodes; ?? edges; ?? predicates"
		      disabled=true
		      value="/data/kelmscott_press.nq">Kelmscott Press</option>
              <option title="all attributes -- ?? nodes; ?? edges; ?? predicates"
		      disabled=true
		      value="/data/minerva_press.nq">Minerva Press</option>
              <option title="all attributes -- ?? nodes; ?? edges; ?? predicates"
		      disabled=true
		      value="/data/victoria_press.nq">Victoria Press</option>
	    </optgroup>
 	    <optgroup label="Genres">
              <option title="all attributes -- ?? nodes; ?? edges; ?? predicates"
		      value="/data/famous_cookbooks.nq">Famous Cookbooks</option>
	    </optgroup>	    
	    <!--

            <option title="The Poetesses -- all attributes -- 1735 nodes; 1646 edges; 11 predicates">/data/poetesses.nq</option>
            <option title="Relations -- all writers -- basic relational predicates -- DANGER! -- 6897 nodes; edges 11761; predicates 10">/data/relations.nq</option>
	    -->


	    <!--
            <option>/data/test_1.nq</option>
            <option>/data/test_40.nq</option>


            <option>/data/test_100.nq</option>
            <option>/data/test_40.ttl</option>
            <option>/data/test_1.ttl</option>
            <option>/data/test_20.ttl</option>
            <option>/data/all.ttl</option>
            <option>/data/all.nq</option>
            <option>/data/test_20.nq</option>
            <option>/data/orlando_ontology.ttl</option>
	    -->
          </select>
        </label>
        <span>
          <button id="reset_btn" style="display:none" type="button" onclick="HVZ.reset_data(this)">
            reset
          </button>
        </span>
      </div>

      <div id="gclui"></div>
    </div>
  </section>
    <div id="vis" class="underneath" style="z-index:-3"></div>
    <div id="viscanvas" class="underneath"></div>
    <pre id="status"></pre>
    <div id="state_msg_box"></div>

    <script src="/huviz/huviz.js?23234"></script>
    <script>
      var HVZ;
      document.addEventListener('touchmove', function(e) {
        e.preventDefault();
      }, false);
      document.addEventListener('dataset-loaded', function(e) {
        //HVZ.choose_everything();
      }, false);

      var getMd = function(url) {
	  var xhr = new XMLHttpRequest();
          xhr.open('GET', url, false);
          xhr.send();
          var resp =  xhr.responseText;
	  return resp;
	};
	var renderMarkdownFromUrlToId = function(mdUri, id) {
            var xhr = new XMLHttpRequest();
            xhr.open('GET', mdUri, true);
            xhr.onload = function(e) {
            if (xhr.readyState === 4) {
              if (xrh.status === 200) {
                var rendered = marked(xhr.responseText);
                console.log("rendered",rendered);
                alert(rendered);
                document.getElementById(id).innerHTML = rendered;
              } else {
                console.log(mdUri, xhr.statusText);
              }
            }
          }
      };
      
      window.addEventListener('load',function(){
        huviz = require('huviz');
        HVZ = new huviz.Orlando();
        HVZ.replace_human_term_spans('ui-widget');
        //HVZ.set_ontology("/data/orlando_ontology.ttl");
        //HVZ.set_ontology("/data/OrlandoOntology-SexesUnderPerson.ttl");
        //HVZ.set_ontology("/data/OrlandoOntology.ttl");
        //HVZ.set_ontology("/data/OrlandoOntologyPull5.ttl");
        HVZ.set_ontology("http://cwrc.ca/ontologies/OrlandoOntology-2015-11-16.ttl");
        HVZ.boot_sequence();

        //renderMarkdownFromUrlToId("/docs/tutorial.md", "external_docs");
	//document.getElementById("external_docs").innerHTML = marked(getMd("/docs/tutorial.md"));

      });
    </script>
  </body>
</html>
